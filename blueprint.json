{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/wp-admin/",
  "login": true,
  "preferredVersions": {
    "php": "8.0",
    "wp": "latest"
  },
  "phpExtensionBundles": [
    "kitchen-sink"
  ],
  "features": {
    "networking": true
  },
  "steps": [
    {
      "step": "installPlugin",
      "pluginZipFile": {
        "resource": "wordpress.org/plugins",
        "slug": "woocommerce"
      }
    },
    {
      "step": "installPlugin",
      "pluginZipFile": {
        "resource": "wordpress.org/plugins",
        "slug": "query-monitor"
      }
    },
    {
      "step": "activatePlugin",
      "pluginPath": "woocommerce/woocommerce.php"
    },
    {
      "step": "activatePlugin",
      "pluginPath": "query-monitor/query-monitor.php"
    },
    {
      "step": "mkdir",
      "path": "/wp-content/mu-plugins"
    },
    {
      "step": "writeFile",
      "path": "/wp-content/mu-plugins/rewrite.php",
      "data": "<?php\n/* Use pretty permalinks */\nadd_action( 'after_setup_theme', function() {\n    global $wp_rewrite;\n    $wp_rewrite->set_permalink_structure('/%postname%/');\n    $wp_rewrite->flush_rules();\n} );"
    },
    {
      "step": "setSiteOptions",
      "options": {
        "blogname": "My WooCommerce Store",
        "woocommerce_store_city": "New York",
        "woocommerce_store_address": "123 Main St",
        "woocommerce_store_postcode": "10001",
        "woocommerce_default_country": "US:NY",
        "woocommerce_onboarding_profile": {
          "skipped": true
        },
        "woocommerce_currency": "USD",
        "woocommerce_weight_unit": "lbs",
        "woocommerce_dimension_unit": "in",
        "woocommerce_allow_tracking": "no",
        "woocommerce_cheque_settings": {
          "enabled": "yes"
        },
        "woocommerce_cod_settings": {
          "enabled": "yes"
        },
        "woocommerce_bacs_settings": {
          "enabled": "yes"
        },
        "woocommerce_calc_taxes": "yes",
        "woocommerce_enable_coupons": "yes",
        "woocommerce_enable_reviews": "yes",
        "woocommerce_enable_review_rating": "yes",
        "woocommerce_manage_stock": "yes",
        "woocommerce_notify_low_stock": "yes",
        "woocommerce_notify_no_stock": "yes",
        "woocommerce_stock_email_recipient": "admin@example.com",
        "woocommerce_notify_low_stock_amount": 2,
        "woocommerce_notify_no_stock_amount": 0,
        "woocommerce_enable_guest_checkout": "yes",
        "woocommerce_enable_checkout_login_reminder": "yes",
        "woocommerce_enable_signup_and_login_from_checkout": "yes",
        "woocommerce_enable_myaccount_registration": "yes",
        "woocommerce_registration_generate_username": "yes",
        "woocommerce_registration_generate_password": "yes"
      }
    },
    {
      "step": "writeFile",
      "path": "/wp-content/mu-plugins/debug-config.php",
      "data": "<?php\n/**\n * Debug configuration for development\n * Using mu-plugin to ensure these are set after wp-config.php\n */\n\n// Only define constants if they haven't been defined already\nif (!defined('WP_DEBUG')) {\n    define('WP_DEBUG', true);\n}\n\nif (!defined('WP_DEBUG_LOG')) {\n    define('WP_DEBUG_LOG', true);\n}\n\nif (!defined('WP_DEBUG_DISPLAY')) {\n    define('WP_DEBUG_DISPLAY', false);\n}\n\nif (!defined('SCRIPT_DEBUG')) {\n    define('SCRIPT_DEBUG', true);\n}\n\nif (!defined('WP_ENVIRONMENT_TYPE')) {\n    define('WP_ENVIRONMENT_TYPE', 'development');\n}\n\n// Additional debug helpers\nif (WP_DEBUG) {\n    // Ensure error reporting is enabled\n    error_reporting(E_ALL);\n    ini_set('display_errors', 0);\n    ini_set('log_errors', 1);\n\n    // Set error log location if not already set\n    if (!ini_get('error_log')) {\n        ini_set('error_log', WP_CONTENT_DIR . '/debug.log');\n    }\n}\n"
    },
    {
      "step": "runPHP",
      "code": "<?php\n// This script creates sample WooCommerce products without requiring WXR import\n// It runs after WooCommerce is activated and ready\n\n// Ensure WooCommerce is active\nif (!class_exists('WC_Product')) {\n    echo 'WooCommerce is not active. Skipping product creation.';\n    exit(0);\n}\n\n// Load required WordPress functions for media handling\nrequire_once(ABSPATH . 'wp-admin/includes/media.php');\nrequire_once(ABSPATH . 'wp-admin/includes/file.php');\nrequire_once(ABSPATH . 'wp-admin/includes/image.php');\n\n// Helper function to download and attach image to product\nfunction attach_product_thumbnail($image_url, $product_id, $filename = '') {\n    if (empty($image_url)) {\n        return false;\n    }\n\n    // Download the image\n    $tmp = download_url($image_url);\n    if (is_wp_error($tmp)) {\n        return false;\n    }\n\n    // Set up file array\n    $file_array = array(\n        'name' => $filename ?: basename($image_url),\n        'tmp_name' => $tmp\n    );\n\n    // If filename doesn't have an extension, add one based on mime type\n    if (!preg_match('/.(jpg|jpeg|png|gif|webp)$/i', $file_array['name'])) {\n        $file_array['name'] = $file_array['name'] . '.jpg';\n    }\n\n    // Upload the image and attach it to the product\n    $attachment_id = media_handle_sideload($file_array, $product_id);\n\n    // Clean up temp file\n    @unlink($tmp);\n\n    if (is_wp_error($attachment_id)) {\n        return false;\n    }\n\n    // Set as product thumbnail\n    set_post_thumbnail($product_id, $attachment_id);\n\n    return $attachment_id;\n}\n\n// Sample product data\n$sample_products = array(\n    array(\n        'name' => 'Premium Quality T-Shirt',\n        'description' => 'This premium quality t-shirt is made from 100% organic cotton. Comfortable, durable, and stylish.',\n        'short_description' => 'Comfortable organic cotton t-shirt',\n        'regular_price' => '29.99',\n        'sale_price' => '24.99',\n        'sku' => 'TSHIRT-001',\n        'stock_status' => 'instock',\n        'categories' => array('Clothing', 'T-Shirts'),\n        'image_url' => 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800',\n        'image_name' => 'premium-tshirt.jpg'\n    ),\n    array(\n        'name' => 'Wireless Bluetooth Headphones',\n        'description' => 'Experience crystal-clear audio with these premium wireless Bluetooth headphones. Features noise cancellation and 30-hour battery life.',\n        'short_description' => 'Premium wireless headphones with noise cancellation',\n        'regular_price' => '149.99',\n        'sale_price' => '119.99',\n        'sku' => 'HEADPHONES-001',\n        'stock_status' => 'instock',\n        'categories' => array('Electronics', 'Audio'),\n        'image_url' => 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800',\n        'image_name' => 'wireless-headphones.jpg'\n    ),\n    array(\n        'name' => 'Organic Coffee Beans - 1kg',\n        'description' => 'Premium organic coffee beans sourced from sustainable farms. Medium roast with notes of chocolate and caramel.',\n        'short_description' => 'Premium organic coffee beans',\n        'regular_price' => '34.99',\n        'sale_price' => '',\n        'sku' => 'COFFEE-001',\n        'stock_status' => 'instock',\n        'categories' => array('Food & Beverage', 'Coffee'),\n        'image_url' => 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=800',\n        'image_name' => 'organic-coffee-beans.jpg'\n    ),\n    array(\n        'name' => 'Yoga Mat - Extra Thick',\n        'description' => 'Professional-grade yoga mat with extra thickness for maximum comfort. Non-slip surface and eco-friendly materials.',\n        'short_description' => 'Extra thick professional yoga mat',\n        'regular_price' => '49.99',\n        'sale_price' => '39.99',\n        'sku' => 'YOGA-MAT-001',\n        'stock_status' => 'instock',\n        'categories' => array('Sports & Fitness', 'Yoga'),\n        'image_url' => 'https://images.unsplash.com/photo-1601925260368-ae2f83cf8b7f?w=800',\n        'image_name' => 'yoga-mat.jpg'\n    ),\n    array(\n        'name' => 'Stainless Steel Water Bottle',\n        'description' => 'Keep your drinks cold for 24 hours or hot for 12 hours with this premium stainless steel water bottle.',\n        'short_description' => 'Insulated stainless steel water bottle',\n        'regular_price' => '24.99',\n        'sale_price' => '',\n        'sku' => 'BOTTLE-001',\n        'stock_status' => 'instock',\n        'categories' => array('Home & Kitchen', 'Drinkware'),\n        'image_url' => 'https://images.unsplash.com/photo-1602143407151-7111542de6e8?w=800',\n        'image_name' => 'water-bottle.jpg'\n    ),\n    array(\n        'name' => 'Leather Wallet - RFID Protected',\n        'description' => 'Genuine leather wallet with RFID protection. Multiple card slots and bill compartments.',\n        'short_description' => 'RFID protected leather wallet',\n        'regular_price' => '59.99',\n        'sale_price' => '49.99',\n        'sku' => 'WALLET-001',\n        'stock_status' => 'instock',\n        'categories' => array('Accessories', 'Wallets'),\n        'image_url' => 'https://images.unsplash.com/photo-1627123424574-724758594e93?w=800',\n        'image_name' => 'leather-wallet.jpg'\n    )\n);\n\n// Create product categories first\n$default_categories = array(\n    'Clothing' => 'Fashion and apparel',\n    'Electronics' => 'Electronic devices and accessories',\n    'Food & Beverage' => 'Food and drink products',\n    'Sports & Fitness' => 'Sports equipment and fitness gear',\n    'Home & Kitchen' => 'Home and kitchen essentials',\n    'Accessories' => 'Fashion and tech accessories',\n    'T-Shirts' => 'Comfortable t-shirts',\n    'Audio' => 'Audio equipment',\n    'Coffee' => 'Coffee products',\n    'Yoga' => 'Yoga equipment',\n    'Drinkware' => 'Bottles and cups',\n    'Wallets' => 'Wallets and cardholders'\n);\n\nforeach ($default_categories as $name => $description) {\n    if (!term_exists($name, 'product_cat')) {\n        wp_insert_term($name, 'product_cat', array(\n            'description' => $description\n        ));\n    }\n}\n\n$created_count = 0;\n$failed_count = 0;\n$images_attached = 0;\n\nforeach ($sample_products as $product_data) {\n    try {\n        // Create product\n        $product = new WC_Product_Simple();\n\n        $product->set_name($product_data['name']);\n        $product->set_description($product_data['description']);\n        $product->set_short_description($product_data['short_description']);\n        $product->set_regular_price($product_data['regular_price']);\n\n        if (!empty($product_data['sale_price'])) {\n            $product->set_sale_price($product_data['sale_price']);\n        }\n\n        $product->set_sku($product_data['sku']);\n        $product->set_stock_status($product_data['stock_status']);\n        $product->set_manage_stock(false);\n        $product->set_status('publish');\n\n        // Set categories\n        $category_ids = array();\n        foreach ($product_data['categories'] as $category_name) {\n            $term = get_term_by('name', $category_name, 'product_cat');\n            if (!$term) {\n                $term_data = wp_insert_term($category_name, 'product_cat');\n                if (!is_wp_error($term_data)) {\n                    $category_ids[] = $term_data['term_id'];\n                }\n            } else {\n                $category_ids[] = $term->term_id;\n            }\n        }\n        $product->set_category_ids($category_ids);\n\n        // Save product first to get ID\n        $product_id = $product->save();\n\n        if ($product_id) {\n            $created_count++;\n\n            // Download and attach the image\n            if (!empty($product_data['image_url'])) {\n                $attachment_id = attach_product_thumbnail(\n                    $product_data['image_url'],\n                    $product_id,\n                    $product_data['image_name']\n                );\n\n                if ($attachment_id) {\n                    $images_attached++;\n\n                    // Also set it as the product image in WooCommerce\n                    $product = wc_get_product($product_id);\n                    $product->set_image_id($attachment_id);\n                    $product->save();\n                }\n            }\n        }\n\n    } catch (Exception $e) {\n        $failed_count++;\n        error_log('Failed to create product: ' . $e->getMessage());\n    }\n}\n\necho \"Sample product import completed. Created $created_count products with $images_attached images attached.\";\n\nif ($failed_count > 0) {\n    echo \" Failed to create $failed_count products.\";\n}\n\n// Flush rewrite rules to ensure product permalinks work\nflush_rewrite_rules();\n?>"
    },
    {
      "step": "writeFile",
      "path": "/wp-content/mu-plugins/playground-helpers.php",
      "data": "<?php\n/**\n * WordPress Playground Development Helpers\n */\n\n// Show admin bar for all users\nadd_filter('show_admin_bar', '__return_true');\n\n// Disable update checks to improve performance\nadd_filter('automatic_updater_disabled', '__return_true');\nremove_action('init', 'wp_schedule_update_checks');\n\n// Add development notice\nadd_action('admin_notices', function() {\n    echo '<div class=\"notice notice-info\"><p>ðŸŽ® Running in WordPress Playground with WooCommerce defaults</p></div>';\n});\n\n// Log all errors to debug.log\nif (WP_DEBUG_LOG) {\n    ini_set('log_errors', 1);\n    ini_set('error_log', WP_CONTENT_DIR . '/debug.log');\n}\n"
    }
  ]
}